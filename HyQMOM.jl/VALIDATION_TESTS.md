# Validation Tests for 3D Unsplit Method

This document describes the validation tests for the 3D unsplit flux method.

## Core Validation Tests (Keep These)

### 1. `test_moment_rotation_unit.jl`
**Purpose**: Unit test for 35-moment tensor rotation formulas  
**What it tests**: Forward + inverse rotation should return original vector  
**Expected result**: Max error = 0.0 (machine precision)  
**Usage**: `julia --project=. test_moment_rotation_unit.jl`

### 2. `test_physical_rotation.jl`
**Purpose**: Full simulation with rotated initial conditions  
**What it tests**: Complete physical rotational invariance  
- Runs reference simulation (no rotation)
- Runs Z-rotated simulation (+90° IC rotation)
- Rotates final state back (-90°)
- Compares all 35 moments

**Expected result**: ~2% error in physical moments (ρ,u,v,w)  
**Usage**: `mpiexec -n 1 julia --project=. test_physical_rotation.jl`

### 3. `test_resolution_convergence.jl`
**Purpose**: Prove error decreases with grid refinement  
**What it tests**: Runs at Nx=16, 20, 24, 32 to check convergence  
**Expected result**: Error reduces ~2x per refinement  
**Usage**: `mpiexec -n 1 julia --project=. test_resolution_convergence.jl`

## Debugging/Development Tests (Can Archive)

### 4. `test_rotational_invariance_final.jl`
**Purpose**: Earlier rotational invariance test (superseded by test_physical_rotation.jl)  
**Status**: Archive or delete

### 5. `test_unsplit_realizability.jl`
**Purpose**: Check that unsplit maintains ρ > 0  
**Status**: Succeeded, can archive

### 6. `test_unsplit_physics.jl`
**Purpose**: Mass conservation check for unsplit  
**Status**: Succeeded, can archive

### 7. `test_split_vs_unsplit_crossing.jl`
**Purpose**: Compare split vs unsplit for crossing jets  
**Status**: Useful for regression testing, keep

### 8. `test_split_vs_unsplit_gridaligned.jl`
**Purpose**: Compare split vs unsplit for grid-aligned case  
**Status**: Useful for regression testing, keep

## Official Test Suite (Do Not Modify)

Located in `test/` directory:
- `test_golden_files.jl` - Compare against MATLAB golden files ✅
- `test_integration.jl` - Integration tests
- `test_autogen.jl` - Autogenerated code tests
- `test_realizability.jl` - Realizability checks
- (others) - Standard unit tests

## Recommended Test Workflow

### Before Committing Changes:
```bash
# 1. Run official test suite
cd HyQMOM.jl
julia --project=. test/runtests.jl

# 2. Run unit tests
julia --project=. test_moment_rotation_unit.jl

# 3. Quick comparison test
mpiexec -n 1 julia --project=. test_split_vs_unsplit_gridaligned.jl

# 4. (Optional) Full physical rotation test
mpiexec -n 1 julia --project=. test_physical_rotation.jl
```

### For Validation Paper/Report:
```bash
# Run all three core validation tests
julia --project=. test_moment_rotation_unit.jl
mpiexec -n 1 julia --project=. test_physical_rotation.jl
mpiexec -n 1 julia --project=. test_resolution_convergence.jl  # Takes ~30min
```

## Files to Clean Up Before PR

Can move to `validation_archive/` or delete:
- `test_rotational_invariance_final.jl` (superseded)
- `test_unsplit_realizability.jl` (one-time check)
- `test_unsplit_physics.jl` (one-time check)
- `compare_split_unsplit_rotation.jl` (if it exists, debugging)

Keep for regression:
- `test_split_vs_unsplit_crossing.jl`
- `test_split_vs_unsplit_gridaligned.jl`

