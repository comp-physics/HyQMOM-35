function moments = unpack_moments35(M4)
% UNPACK_MOMENTS35 Extracts 35 moments into a named structure
%
%   moments = unpack_moments35(M4) takes a 35-element vector M4 and returns
%   a structure with named moment fields (M000, M100, ..., M022)
%
%   Input:
%       M4 - 35-element vector of moments
%   Output:
%       moments - Structure with 35 named fields

% Define moment indices for easier maintenance
% M = [M000,M100,M200,M300,M400,M010,M110,M210,M310,M020,M120,M220,M030,M130,M040,...
%      M001,M101,M201,M301,M002,M102,M202,M003,M103,M004,M011,M111,M211,M021,M121,...
%      M031,M012,M112,M013,M022]

idx = struct(...
    'M000', 1,  'M100', 2,  'M200', 3,  'M300', 4,  'M400', 5, ...
    'M010', 6,  'M110', 7,  'M210', 8,  'M310', 9, ...
    'M020', 10, 'M120', 11, 'M220', 12, ...
    'M030', 13, 'M130', 14, ...
    'M040', 15, ...
    'M001', 16, 'M101', 17, 'M201', 18, 'M301', 19, ...
    'M002', 20, 'M102', 21, 'M202', 22, ...
    'M003', 23, 'M103', 24, ...
    'M004', 25, ...
    'M011', 26, 'M111', 27, 'M211', 28, ...
    'M021', 29, 'M121', 30, ...
    'M031', 31, ...
    'M012', 32, 'M112', 33, ...
    'M013', 34, ...
    'M022', 35);

% Extract all moments at once using structfun
fields = fieldnames(idx);
moments = struct();
for i = 1:length(fields)
    moments.(fields{i}) = M4(idx.(fields{i}));
end

end

