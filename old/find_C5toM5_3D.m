clear
clc

syms M000 positive
syms umean vmean wmean real
syms C200 C110 C101 C020 C011 C002 real
syms C300 C210 C201 C120 C111 C102 C030 C021 C012 C003 real
syms C400 C310 C301 C220 C211 C202 C130 C121 C112 C103 C040 C031 C022 C013 C004 real
syms C500 C410 C320 C230 C140 C401 C302 C203 C104 C311 C221 C131 C212 C113 C122 C050 C041 C032 C023 C014 C005 real

syms C5 [6 6 6] real

M5 = 0*C5;

%
C5(1,1,1) = 1;
%
C5(2,1,1) = 0;
C5(1,2,1) = 0;
C5(1,1,2) = 0;
%    
C5(3,1,1)=C200;
C5(2,2,1)=C110;
C5(2,1,2)=C101;
C5(1,3,1)=C020;
C5(1,2,2)=C011;
C5(1,1,3)=C002;
%
C5(4,1,1)=C300;
C5(3,2,1)=C210;
C5(3,1,2)=C201;
C5(2,3,1)=C120;
C5(2,2,2)=C111;
C5(2,1,3)=C102;
C5(1,4,1)=C030;
C5(1,3,2)=C021;
C5(1,2,3)=C012;
C5(1,1,4)=C003;
%
C5(5,1,1)=C400;
C5(4,2,1)=C310;
C5(4,1,2)=C301;
C5(3,3,1)=C220;
C5(3,2,2)=C211;
C5(3,1,3)=C202;
C5(2,4,1)=C130;
C5(2,3,2)=C121;
C5(2,2,3)=C112;
C5(2,1,4)=C103;
C5(1,5,1)=C040;
C5(1,4,2)=C031;
C5(1,3,3)=C022;
C5(1,2,4)=C013;
C5(1,1,5)=C004;
%
C5(6,1,1)=C500;
C5(5,2,1)=C410; 
C5(4,3,1)=C320;
C5(3,4,1)=C230;
C5(2,5,1)=C140;
C5(5,1,2)=C401; 
C5(4,1,3)=C302; 
C5(3,1,4)=C203; 
C5(2,1,5)=C104; 
C5(4,2,2)=C311; 
C5(3,3,2)=C221; 
C5(2,4,2)=C131; 
C5(3,2,3)=C212; 
C5(2,2,4)=C113; 
C5(2,3,3)=C122; 
C5(1,6,1)=C050; 
C5(1,5,2)=C041; 
C5(1,4,3)=C032; 
C5(1,3,4)=C023; 
C5(1,2,5)=C014; 
C5(1,1,6)=C005;

% find M5 from C5
for i=0:5 
    for j=0:5
        for k=0:5
            if i+j+k <= 5
                M5(i+1,j+1,k+1) = 0;
                for m = 0:i
                    for n = 0:j
                        for p = 0:k
                            M5(i+1,j+1,k+1) = M5(i+1,j+1,k+1) + M000*nchoosek(i,m)*nchoosek(j,n)*nchoosek(k,p)*(umean^(i-m))*(vmean^(j-n))*(wmean^(k-p))*C5(1+m,1+n,1+p);
                        end
                    end
                end
                simplify(M5(i+1,j+1,k+1));
            end
        end
    end
end

var = [M000,umean,vmean,wmean,C200,C110,C101,C020,C011,C002,...
       C300,C210,C201,C120,C111,C102,C030,C021,C012,C003,...
       C400,C310,C301,C220,C211,C202,C130,C121,C112,C103,C040,C031,C022,C013,C004,...
       C500,C410,C320,C230,C140,C401,C302,C203,C104,C311,C221,C131,C212,C113,C122,C050,C041,C032,C023,C014,C005];

matlabFunction(M5,'File','C5toM5_3D','Vars',var)